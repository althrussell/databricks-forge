# Databricks Apps runtime configuration
# Resources and scopes are bound automatically by deploy.sh.
#
# Resource bindings (set by deploy.sh via Apps API):
#   sql-warehouse        → DATABRICKS_WAREHOUSE_ID
#   serving-endpoint     → DATABRICKS_SERVING_ENDPOINT
#   serving-endpoint-fast → DATABRICKS_SERVING_ENDPOINT_FAST
#
# User authorization scopes (set by deploy.sh via Apps API):
#   sql, catalog.tables:read, catalog.schemas:read,
#   catalog.catalogs:read, files.files, dashboards.genie
#
# Auth model:
#   - SQL queries run as the logged-in user (OBO via x-forwarded-access-token)
#   - Genie Space management uses user OBO by default (configurable in Settings)
#   - Model Serving, Workspace API run as the app service principal
#   - Background pipeline tasks fall back to service principal
#
# Lakebase Autoscale is self-provisioned at startup using the platform-
# injected service principal credentials (DATABRICKS_CLIENT_ID/SECRET/HOST).
# No secret scope or DATABASE_URL binding needed.

command:
  - "sh"
  - "scripts/start.sh"

env:
  - name: DATABRICKS_WAREHOUSE_ID
    valueFrom: sql-warehouse
  - name: DATABRICKS_SERVING_ENDPOINT
    valueFrom: serving-endpoint
  - name: DATABRICKS_SERVING_ENDPOINT_FAST
    valueFrom: serving-endpoint-fast
